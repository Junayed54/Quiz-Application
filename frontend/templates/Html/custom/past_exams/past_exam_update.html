{% comment %} @SPK@include("partials/mainhead.html") {% endcomment %}
{% include "../../partials/mainhead.html"%}
<!-- <link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/47.0.0/ckeditor5.css"> -->
<link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.css" />

<style>
    .details {
    max-height: 600px;
    overflow-y: auto;
    overflow-x: hidden;
    padding-right: 10px;
    scroll-behavior: smooth; /* smooth scrolling */
}

/* ✅ Always show scrollbar in WebKit browsers (Chrome, Edge, Safari) */
.details::-webkit-scrollbar {
    width: 8px; /* scrollbar width */
}

.details::-webkit-scrollbar-track {
    background: #f1f1f1; /* track color */
    border-radius: 10px;
}

.details::-webkit-scrollbar-thumb {
    background: #888; /* scrollbar color */
    border-radius: 10px;
}

.details::-webkit-scrollbar-thumb:hover {
    background: #555; /* hover color */
}

/* ✅ Firefox support */
.details {
    scrollbar-width: thin;
    scrollbar-color: #888 #f1f1f1;
}

    .drop-area {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
    }
    .drop-area.drag-over {
        background-color: #f0f0f0;
    }
    .img-preview {
        max-width: 100%;
        max-height: 300px;
        margin-top: 10px;
    }
    .exam-container {
        margin-top: 20px;
    }

    /* Existing height classes */
.explanation-editor-height {
    min-height: 200px; 
}
.explanation-editor-height .ck-editor__editable_inline {
    min-height: 200px;
    max-height: 400px; 
    overflow-y: auto;
}

/* Bootstrap-like styling for CKEditor container */
/* This targets the main wrapper created by CKEditor */
.form-control > .ck-editor__main > .ck-editor__editable {
    /* Add some padding and border to mimic a text field */
    padding: .375rem .75rem; 
    border: 1px solid #ced4da; 
    border-radius: .25rem;
}

/* Fix the overall CKEditor wrapper styling */
.form-control .ck-editor__main {
    /* Remove the wrapper's internal border if necessary */
    border: none !important;
}

/* Ensure the editor itself gets padding when it replaces the element */
.ck-editor__editable_inline {
    border-radius: 0 0 .25rem .25rem !important; /* Adjust corners */
}
</style>


    
</head>

<body>

    {% comment %} @SPK@include("partials/switcher.html") {% endcomment %}
    {% include "../../partials/switcher.html" %}
    <div class="page">
        {% comment %} @SPK@include("partials/header.html") {% endcomment %}
        {% include "../../partials/header.html"%}
        {% comment %} @SPK@include("partials/sidebar.html") {% endcomment %}
        {% include "../../partials/sidebar.html" %}
        <!-- Start::app-content -->
        <div class="main-content app-content">

            <!-- HTML structure for displaying submitted users and their questions -->
            

            <div class="container exam-container details" id="exam-detail">
                <!-- Exam details will be populated here -->
            </div>
            
            

            
        </div>
        <!-- End::app-content -->

        {% comment %} @SPK@include("partials/headersearch_modal.html") {% endcomment %}
        {% include "../../partials/headersearch_modal.html"%}
        {% comment %} @SPK@include("partials/footer.html") {% endcomment %}
        {% include "../../partials/footer.html" %}
    </div>

    {% comment %} @SPK@include("partials/commonjs.html") {% endcomment %}
    {% include "../../partials/commonjs.html"%}


    <!-- <script src="https://cdn.ckeditor.com/ckeditor5/47.0.0/ckeditor5.umd.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.js"></script>
    
    {% comment %} @SPK@include("partials/custom_switcherjs.html") {% endcomment %}
    {% include "../../partials/custom_switcherjs.html"%}
    <!-- Custom JS -->
    <script src="../../../../static/assets/js/custom.js"></script>

    <!-- My exam js -->
    <script src = "../../../../static/Js/past_exams/past_exam_update.js"></script>


    <script>
    document.addEventListener("DOMContentLoaded", function () {
        
        // Define the standard Quill toolbar options, including 'formula' for math
        const toolbarOptions = [
        [{ 'font': [] }, { 'size': [] }],
        [{ 'header': [1, 2, 3, false] }],
        ['bold', 'italic', 'underline', 'strike'],
        ['blockquote', 'code-block'],
        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
        [{ 'indent': '-1' }, { 'indent': '+1' }],
        [{ 'align': [] }],
        [{ 'color': [] }, { 'background': [] }],
        ['link', 'image', 'video'],
        ['table'],   // ✅ Native Quill 2 table button
        ['clean']
    ];
    
    const quill = new Quill(`#${editorId}`, {
        theme: 'snow',
        modules: {
            toolbar: { container: toolbarOptions },
            table: true   // ✅ Enable native table support
        }
    });
        // 1. Target all dynamically created elements that need a Quill editor
        // We use the class 'quill-target' to select them.
        const quillTargets = document.querySelectorAll('.quill-target');
        const activeQuillEditors = []; // To hold references to the initialized Quill objects

        // Find the main form (you may need to adjust this selector)
        // This assumes there is one primary form that contains all the explanation inputs.
        const form = document.querySelector('form'); 

        quillTargets.forEach(editorElement => {
            const editorId = editorElement.id; // e.g., "explanation_editor_123"
            const questionId = editorId.split('_').pop(); // Extracts the ID, e.g., "123"
            
            // 2. Initialize Quill for the current dynamic element
            const quillInstance = new new Quill(`#${editorId}`, {
                theme: 'snow',
                modules: {
                    toolbar: toolbarOptions,
                    formula: true // Activate the formula module for math equations
                }
            });

            // Store the instance and its ID
            activeQuillEditors.push({ id: questionId, editor: quillInstance });
        });

        // 3. Attach a single submit listener to the main form to save all editor contents
        if (form) {
            form.addEventListener('submit', function() {
                activeQuillEditors.forEach(item => {
                    const quillInstance = item.editor;
                    const questionId = item.id;
                    
                    // Construct the ID for the associated hidden input field
                    const hiddenInputId = `explanation_editor_${questionId}_hidden`;
                    const hiddenInput = document.getElementById(hiddenInputId);
                    
                    if (hiddenInput) {
                        // Populate the hidden input with the editor's HTML content
                        hiddenInput.value = quillInstance.root.innerHTML;
                        console.log(`Saved content for question ${questionId}`);
                    }
                });
                // The form submission will continue after this loop
            });
        }
        
        // Optional: Make the list of editors globally accessible if needed for other scripts
        window.activeQuillEditors = activeQuillEditors;
    });
    </script>

</body>

</html>