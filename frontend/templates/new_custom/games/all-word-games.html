{% extends 'new_custom/new_templates/index2.html' %}
{% load static %}

{% block title %}Puzzle Gallery | Word Scramble{% endblock %}

{% block style %}
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        --secondary-gradient: linear-gradient(135deg, #344422 0%, #22e52f 100%);
    }

    body { background-color: #fcfcfd; }

    /* Center the header and text */
    .gallery-header {
        padding: 4rem 0 2rem;
        text-align: center;
    }

    /* Grid Centering Logic */
    #game-grid {
        display: flex;
        justify-content: center; /* This centers the cards */
        flex-wrap: wrap;
    }

    .game-card {
        transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        border: none;
        border-radius: 24px;
        background: #ffffff;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        max-width: 350px; /* Limits width for a more "designable" look */
    }

    .game-card:hover {
        transform: translateY(-12px);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.12) !important;
    }

    .card-img-container {
        position: relative;
        padding: 12px;
    }

    .card-img-top {
        border-radius: 20px;
        height: 220px;
        object-fit: cover;
    }

    .status-badge {
        position: absolute;
        top: 25px;
        right: 25px;
        padding: 8px 16px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 700;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .play-btn {
        border-radius: 14px;
        font-weight: 700;
        padding: 8px;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: 0.3s;
        border: none;
        background: var(--primary-gradient);
        color: white;
        text-decoration: none;
    }

    .play-btn:hover {
        box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.5);
        color: white;
        transform: scale(1.02);
    }

    .text-success { color: #10b981 !important; }
    .text-primary { color: #6366f1 !important; }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="gallery-header">
        <h1 class="fw-black display-4 mb-2">Puzzle Gallery</h1>
        <p class="text-muted mx-auto" style="max-width: 500px;">Challenge your mind with our premium word scramble puzzles. Centered for focus, designed for fun.</p>
        
        <div id="api-status-box" class="mt-4">
            <span id="api-status" class="badge rounded-pill bg-light text-dark p-2 px-3 border">
                <span class="spinner-grow spinner-grow-sm text-primary me-2"></span>
                Loading games...
            </span>
        </div>
    </div>

    <div id="game-grid" class="row g-5 pb-5">
        </div>
</div>
{% endblock %}

{% block body_js %}
<script>
const API_ENDPOINT = '/api/word-puzzles/'; 
const FALLBACK_IMAGE = 'https://images.unsplash.com/photo-1550684848-fac1c5b4e853?auto=format&fit=crop&q=80&w=400';

async function fetchGames() {
    const grid = document.getElementById('game-grid');
    
    try {
        const response = await fetch(API_ENDPOINT);
        const games = await response.json();
        
        document.getElementById('api-status').innerHTML = `${games.length} Puzzles Found`;

        grid.innerHTML = games.map(game => {
            const statusConfig = {
                'active': { class: 'text-success', label: 'â— LIVE', action: 'Play Now', disabled: '' },
                'upcoming': { class: 'text-primary', label: 'ðŸ“… SOON', action: 'Locked', disabled: 'disabled' },
                'ended': { class: 'text-muted', label: 'ðŸ”’ CLOSED', action: 'Finished', disabled: 'disabled' }
            };

            const config = statusConfig[game.status] || statusConfig['active'];
            const banner = (game.banner && game.banner.trim() !== "") ? game.banner : FALLBACK_IMAGE;

            /** * Generate URL Friendly Title:
             * 'Modern Puzzle 1' -> 'modern-puzzle-1'
             */
            const gameSlug = encodeURIComponent(game.title.toLowerCase().replace(/\s+/g, '-'));
            const gameUrl = `/word-games/${gameSlug}/`;

            return `
                <div class="col-12 col-md-6 col-lg-4 d-flex justify-content-center">
                    <div class="card game-card h-100 w-100">
                        <div class="card-img-container">
                            <img src="${banner}" 
                                 class="card-img-top" 
                                 alt="${game.title}"
                                 onerror="this.onerror=null;this.src='${FALLBACK_IMAGE}';">
                            <div class="status-badge ${config.class}">
                                ${config.label}
                            </div>
                        </div>
                        <div class="card-body d-flex flex-column text-center px-4 pb-4">
                            <h3 class="h5 fw-bold mb-1 text-dark">${game.title}</h3>
                            <!-- <p class="small text-muted mb-4">Ends: ${new Date(game.end_date).toLocaleDateString()}</p> -->
                            
                            <div class="my-2">
                                <a href="${game.status === 'active' ? gameUrl : '#'}" 
                                   class=" play-btn w-100 ${config.disabled}"
                                   style="${game.status !== 'active' ? 'opacity: 0.6; cursor: not-allowed;' : ''}">
                                    ${config.action}
                                </a>
                            </div>
                            <div class="mt-2">
                                <a href="leaderboard/" 
                                   class=" play-btn w-100 ${config.disabled}"
                                   style="${game.status !== 'active' ? 'opacity: 0.6; cursor: not-allowed;' : ''}">
                                    Leaderboard
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

    } catch (error) {
        console.error("Error:", error);
        grid.innerHTML = `<div class="col-12 text-center py-5">Error connecting to game server.</div>`;
    }
}

fetchGames();
</script>
{% endblock %}