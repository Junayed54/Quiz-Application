{% extends 'new_custom/new_templates/index2.html' %}
{% block title %}চাকরি নিউজ{% endblock %}

{% block style %}
<style>
/* Center the news container */
.news-container {
    display: flex;
    flex-direction: column;
    align-items: center; /* horizontal center */
    justify-content: center; /* vertical center */
    min-height: 70vh; /* take most of the viewport height */
}

/* List container */
.news-list {
    list-style: none;
    padding: 0;
    margin: 0;
    width: 100%;
    max-width: 700px; /* limit width for better readability */
}

/* List items */
.news-item {
    border-bottom: 1px solid #e5e7eb;
    padding: 1rem 0;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.news-item:last-child {
    border-bottom: none;
}

/* Thumbnail image */
.news-thumb {
    width: 120px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    flex-shrink: 0;
}

/* Title and meta container */
.news-content {
    flex: 1;
}

.news-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #231651;
    text-decoration: none;
    margin-bottom: 0.25rem;
    display: block;
}

.news-title:hover {
    color: #ff4b4b;
}

.news-meta {
    font-size: 0.8rem;
    color: #6b7280;
    margin-bottom: 0.25rem;
}

/* Read more link */
.btn-custom {
    display: inline-block;
    background-color: #ff4b4b;
    color: #fff;
    border: none;
    padding: 4px 12px;
    border-radius: 25px;
    font-size: 0.8rem;
    font-weight: 600;
    text-decoration: none;
    transition: background-color 0.3s ease;
}

.btn-custom:hover {
    background-color: #e64242;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .news-item {
        flex-direction: column;
        align-items: flex-start;
    }
    .news-thumb {
        width: 100%;
        height: 180px;
    }
}
</style>
{% endblock %}

{% block content %}
<main class="container py-5">
    <div class="text-center mb-5">
        <p class="lead text-muted">চাকরি, শিক্ষা, এবং অন্যান্য গুরুত্বপূর্ণ খবর</p>
    </div>

    <div class="news-container">
        <div id="loading-message" class="text-center my-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">সংবাদ লোড হচ্ছে...</p>
        </div>

        <ul id="news-list" class="news-list"></ul>

        <div id="no-news-message" class="text-center d-none my-5">
            <p class="lead text-muted">কোনো সংবাদ পাওয়া যায়নি।</p>
        </div>

        <div id="error-message" class="text-center d-none my-5">
            <p class="lead text-danger">সংবাদ লোড করতে সমস্যা হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন।</p>
        </div>
    </div>

    <nav aria-label="Page navigation" class="mt-5 d-flex justify-content-center">
        <ul class="pagination"></ul>
    </nav>
</main>
{% endblock %}


{% block body_js %}
<script>
document.addEventListener("DOMContentLoaded", async function() {
    const newsList = document.getElementById('news-list');
    const paginationContainer = document.querySelector('.pagination');
    const loadingMessage = document.getElementById('loading-message');
    const noNewsMessage = document.getElementById('no-news-message');
    const errorMessage = document.getElementById('error-message');

    let currentPage = 1;
    const itemsPerPage = 9;

    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const date = new Date(dateString);
        return date.toLocaleDateString('bn-BD', options);
    }

    function renderNewsItems(newsListData) {
        newsList.innerHTML = '';
        if (newsListData.length > 0) {
            newsListData.forEach(news => {
                const imageUrl = news.images?.length > 0
                    ? news.images[0].image_url
                    : 'https://via.placeholder.com/120x80.png?text=No+Image';
                const newsItem = document.createElement('li');
                newsItem.className = 'news-item';
                newsItem.innerHTML = `
                    <img src="${imageUrl}" alt="${news.title}" class="news-thumb">
                    <div class="news-content">
                        <a href="/news/details/${news.id}" class="news-title">${news.title}</a>
                        <p class="news-meta"><i class="fa-solid fa-calendar-alt"></i> ${formatDate(news.published_date)}</p>
                        <a href="/news/details/${news.id}" class="btn-custom">বিস্তারিত পড়ুন</a>
                    </div>
                `;
                newsList.appendChild(newsItem);
            });
            noNewsMessage.classList.add('d-none');
        } else {
            noNewsMessage.classList.remove('d-none');
        }
    }

    function renderPagination(count, next, previous) {
        paginationContainer.innerHTML = '';

        const totalPages = Math.ceil(count / itemsPerPage);
        if (totalPages <= 1) return;

        // Previous button
        const prevItem = document.createElement('li');
        prevItem.className = `page-item ${!previous ? 'disabled' : ''}`;
        prevItem.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">পূর্ববর্তী</a>`;
        paginationContainer.appendChild(prevItem);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const pageItem = document.createElement('li');
            pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
            pageItem.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
            paginationContainer.appendChild(pageItem);
        }

        // Next button
        const nextItem = document.createElement('li');
        nextItem.className = `page-item ${!next ? 'disabled' : ''}`;
        nextItem.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">পরবর্তী</a>`;
        paginationContainer.appendChild(nextItem);

        // Add click handlers
        paginationContainer.querySelectorAll('.page-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const newPage = parseInt(this.getAttribute('data-page'));
                if (newPage >= 1 && newPage <= totalPages && newPage !== currentPage) {
                    currentPage = newPage;
                    fetchAndRenderNews(currentPage);
                    newsList.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    }

    async function fetchAndRenderNews(page = 1) {
        loadingMessage.classList.remove('d-none');
        noNewsMessage.classList.add('d-none');
        errorMessage.classList.add('d-none');

        try {
            const response = await fetch(`/api/news/?page=${page}`);
            if (!response.ok) throw new Error('Network response was not ok');

            const data = await response.json();
            loadingMessage.classList.add('d-none');

            renderNewsItems(data.results);
            renderPagination(data.count, data.next, data.previous);
        } catch (error) {
            console.error('Error fetching news:', error);
            loadingMessage.classList.add('d-none');
            errorMessage.classList.remove('d-none');
        }
    }

    // Initial load
    fetchAndRenderNews(currentPage);
});
</script>

{% endblock %}
