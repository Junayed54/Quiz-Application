{% extends 'new_custom/new_templates/index2.html' %}
{% block title %}চাকরি নিউজ{% endblock %}
{% block style %}
  <style>
    
    .card-img-top {
      height: 200px; /* Fixed height for consistent card appearance */
      object-fit: cover; /* Ensures the image covers the area without distortion */
    }
    .card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: none;
      border-radius: 10px;
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .card-body {
      padding: 1.5rem;
    }
    .news-title {
      font-size: 1.25rem;
      font-weight: bold;
      color: #231651;
      text-decoration: none;
      display: block;
      margin-bottom: 0.5rem;
    }
    .news-title:hover {
      color: #ff4b4b;
    }
    .news-meta {
      font-size: 0.85rem;
      color: #777;
    }
    .btn-custom {
        background-color: #ff4b4b;
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 50px;
        text-decoration: none;
        transition: background-color 0.3s ease;
    }
    .btn-custom:hover {
      background-color: #e64242;
      color: white;
    }
  </style>
{% endblock %}
{% block content %}

  <main class="container py-5">
    <div class="text-center mb-5">
      <!-- <h1>আমাদের সকল সংবাদ</h1> -->
      <p class="lead text-muted">চাকরি, শিক্ষা, এবং অন্যান্য গুরুত্বপূর্ণ খবর</p>
    </div>

    <div id="loading-message" class="text-center my-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">সংবাদ লোড হচ্ছে...</p>
    </div>

    <div id="news-grid" class="row g-4">
      </div>

    <div id="no-news-message" class="text-center d-none my-5">
      <p class="lead text-muted">কোনো সংবাদ পাওয়া যায়নি।</p>
    </div>

    <div id="error-message" class="text-center d-none my-5">
      <p class="lead text-danger">সংবাদ লোড করতে সমস্যা হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন।</p>
    </div>

    <nav aria-label="Page navigation" class="mt-5 d-flex justify-content-center">
      <ul class="pagination">
        </ul>
    </nav>
  </main>
{% endblock %}
{% block body_js %}
  <script>
    document.addEventListener("DOMContentLoaded", async function() {
      const newsGrid = document.getElementById('news-grid');
      const paginationContainer = document.querySelector('.pagination');
      const loadingMessage = document.getElementById('loading-message');
      const noNewsMessage = document.getElementById('no-news-message');
      const errorMessage = document.getElementById('error-message');

      // --- Pagination Variables ---
      const itemsPerPage = 9; // Display 9 items per page (3 rows of 3 on large screens)
      let currentPage = 1;
      let allNewsData = [];
      // ----------------------------

      // Function to format the date
      function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const date = new Date(dateString);
        return date.toLocaleDateString('bn-BD', options);
      }

      // --- Rendering Functions ---

      // Renders the news items for the current page
      function renderNewsItems(page) {
        newsGrid.innerHTML = ''; // Clear existing news
        
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        
        const newsToDisplay = allNewsData.slice(startIndex, endIndex);

        if (newsToDisplay.length > 0) {
          newsToDisplay.forEach(news => {
            const newsItemCol = document.createElement('div');
            // Using col-lg-4 for 3 columns on large screens
            newsItemCol.className = 'col-md-6 col-lg-4'; 

            const imageUrl = news.images.length > 0 ? news.images[0].image_url : 'https://via.placeholder.com/400x200.png?text=No+Image';
            
            newsItemCol.innerHTML = `
              <div class="card h-100 shadow-sm">
                <img src="${imageUrl}" class="card-img-top" alt="${news.title}">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">
                    <a href="/news/${news.id}" class="news-title">${news.title}</a>
                  </h5>
                  <p class="news-meta">
                    <i class="fa-solid fa-calendar-alt"></i> ${formatDate(news.published_date)}
                  </p>
                  <p class="card-text">${news.content.substring(0, 150)}...</p>
                  <a href="/news/details/${news.id}" class="btn btn-custom mt-auto">বিস্তারিত পড়ুন</a>
                </div>
              </div>
            `;
            newsGrid.appendChild(newsItemCol);
          });
          noNewsMessage.classList.add('d-none');
        } else {
          noNewsMessage.classList.remove('d-none');
        }
      }

      // Renders the pagination links
      function renderPagination(totalItems) {
        paginationContainer.innerHTML = ''; // Clear existing pagination
        const totalPages = Math.ceil(totalItems / itemsPerPage);

        if (totalPages <= 1) return; // No need for pagination

        // --- Previous button ---
        const prevItem = document.createElement('li');
        prevItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
        prevItem.innerHTML = `<a class="page-link" href="#" aria-label="Previous" data-page="${currentPage - 1}">পূর্ববর্তী</a>`;
        paginationContainer.appendChild(prevItem);

        // --- Page number buttons ---
        // A simple loop for all pages (can be improved for large page counts)
        for (let i = 1; i <= totalPages; i++) {
          const pageItem = document.createElement('li');
          pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
          pageItem.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
          paginationContainer.appendChild(pageItem);
        }

        // --- Next button ---
        const nextItem = document.createElement('li');
        nextItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
        nextItem.innerHTML = `<a class="page-link" href="#" aria-label="Next" data-page="${currentPage + 1}">পরবর্তী</a>`;
        paginationContainer.appendChild(nextItem);

        // --- Attach click listener for page change ---
        paginationContainer.querySelectorAll('.page-link').forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const newPage = parseInt(this.getAttribute('data-page'));
            
            // Check for valid page number
            if (newPage >= 1 && newPage <= totalPages && newPage !== currentPage) {
              currentPage = newPage;
              // Scroll to the top of the news grid
              newsGrid.scrollIntoView({ behavior: 'smooth', block: 'start' }); 
              renderNewsItems(currentPage);
              renderPagination(totalItems); // Re-render pagination to update active state
            }
          });
        });
      }

      // --- Main Fetch Logic ---
      try {
        const response = await fetch('/api/news/');
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        
        allNewsData = await response.json(); // Store all data
        loadingMessage.classList.add('d-none');

        if (allNewsData.length > 0) {
          // Initialize display
          renderNewsItems(currentPage);
          renderPagination(allNewsData.length);
        } else {
          noNewsMessage.classList.remove('d-none');
        }

      } catch (error) {
        console.error('Error fetching news:', error);
        loadingMessage.classList.add('d-none');
        errorMessage.classList.remove('d-none');
      }
    });
  </script>
{% endblock %}