<section class="py-5" style="background-color: transparent;">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center mb-5">
        <h2 class="display-5 fw-bold mb-2">শীর্ষ সংবাদসমুহ</h2>
        <p class="lead text-muted">দৈনিক চাকরি ও শিক্ষাবিষয়ক সর্বশেষ খবর</p>
      </div>
      <div class="col-12" style="background-color: transparent;">
        <div id="newsCarousel" class="carousel slide shadow-sm rounded" data-bs-ride="carousel" style="background-color: transparent;">
          <div class="carousel-inner" id="news-carousel-inner"></div>
          <button class="carousel-control-prev" type="button" data-bs-target="#newsCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon bg-dark bg-opacity-50 rounded-circle" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#newsCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon bg-dark bg-opacity-50 rounded-circle" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
        <div id="no-news-message" class="text-center mt-4 d-none">
          <p class="text-muted fs-5">আজকের জন্য কোনো সংবাদ পাওয়া যায়নি।</p>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .carousel-item {
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
  }
  .news-content {
    max-width: 600px;
  }
  
  .carousel-control-prev, .carousel-control-next {
    width: 5%;
    
  }
  .carousel-control-prev-icon, .carousel-control-next-icon {
    width: 2rem;
    height: 2rem;
  }
  @media (max-width: 768px) {
    .carousel-item img {
      max-height: 200px;
    }
    .news-content {
      text-align: center;
    }
    .carousel-control-prev, .carousel-control-next {
      margin-top: 15px;
      width: 7%;
    
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const newsCarouselInner = document.getElementById('news-carousel-inner');
    const noNewsMessage = document.getElementById('no-news-message');

    // Format date in Bangla
    function formatDate(dateString) {
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('bn-BD', options);
    }

    // Fetch and display news
    async function fetchNews() {
      try {
        const response = await fetch('/api/news/', {
          headers: { 'Accept': 'application/json' }
        });
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const newsData = await response.json();

        // Filter news for today
        const today = new Date();
        const todayUTC = new Date(Date.UTC(today.getFullYear(), today.getMonth(), today.getDate()));
        const todayNews = newsData.filter(news => {
          const publishedDate = new Date(news.published_date);
          const publishedDateUTC = new Date(Date.UTC(publishedDate.getFullYear(), publishedDate.getMonth(), publishedDate.getDate()));
          return publishedDateUTC.getTime() === todayUTC.getTime();
        });

        if (todayNews.length > 0) {
          let isFirstItem = true;
          todayNews.forEach(news => {
            const carouselItem = document.createElement('div');
            carouselItem.className = `carousel-item${isFirstItem ? ' active' : ''}`;

            const imageUrl = news.images?.length > 0 ? news.images[0].image_url : '/assets/images/default-news.png';

            carouselItem.innerHTML = `
              <div class="d-flex flex-column flex-md-row  justify-content-center text-center text-md-start" style="background-color: transparent;">
                <img src="${imageUrl}" class="d-block img-fluid me-md-4 mb-3 mb-md-0" style="max-height: 250px; object-fit: cover; border-radius: 8px;" alt="${news.title}">
                <div class="news-content" >
                  <h5 class="fw-bold mb-3">${news.title}</h5>
                  <p class="text-muted mb-2"><small>প্রকাশের তারিখ: ${formatDate(news.published_date)}</small></p>
                  <p class="text-secondary">${news.content.substring(0, 250)}...</p>
                  <a href="/news/details/${news.id}" class="btn btn-custom mt-2">আরও পড়ুন</a>
                </div>
              </div>
            `;
            newsCarouselInner.appendChild(carouselItem);
            isFirstItem = false;
          });

          // Initialize Bootstrap carousel
          const newsCarousel = document.getElementById('newsCarousel');
          if (newsCarousel) {
            new bootstrap.Carousel(newsCarousel, {
              interval: 5000,
              pause: 'hover',
              wrap: true
            });
          }
        } else {
          noNewsMessage.classList.remove('d-none');
        }
      } catch (error) {
        console.error('Error fetching news:', error);
        noNewsMessage.classList.remove('d-none');
      }
    }

    fetchNews();
  });
</script>