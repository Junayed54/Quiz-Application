<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video with VAST Ad and Floating Ad (videojs-vast-vpaid 2.0.2)</title>
    
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" /> 
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs.vast.vpaid.min.css" rel="stylesheet" />
    
    <style>
        /* Optional: Center the big play button */
        .video-js .vjs-big-play-button {
            top: 45%;
            left: 45%;
            transform: translate(-50%, -50%); /* For perfect centering */
        }

        /* Styles for the floating ad */
        #floating-ad-container {
            position: fixed;
            top: 20px; /* Adjust as needed */
            right: 20px; /* Adjust as needed */
            width: 300px; /* Example width */
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
            z-index: 1000; /* Ensure it's above other content */
            display: none; /* Hidden by default, show on scroll */
        }

        #floating-ad-container.show {
            display: block;
        }

        #floating-ad-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin-bottom: 5px;
        }

        #close-floating-ad {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        #close-floating-ad:hover {
            color: #000;
        }
    </style>
</head>
<body>

    <video id="my-video" class="video-js vjs-default-skin" width="640" height="360" controls preload="auto">
        <source src="https://www.dropbox.com/scl/fi/wu5l36aztwtaj659f4gg7/2025-04-07-10-25-08.mp4?rlkey=31n1ah9tm6665s78nqxm013w6&st=69l3jfos&dl=1" type="video/mp4">
        Your browser does not support HTML5 video.
    </video>

    <div id="floating-ad-container">
        <span id="close-floating-ad">&times;</span>
        <h4>Sponsored Content</h4>
        <div id="floating-ad-content">
            <img src="https://via.placeholder.com/300x250?text=Your+Ad+Here" alt="Floating Ad">
            <p>This is a sample floating ad. Click the 'X' to close it.</p>
        </div>
    </div>

    <p style="height: 1000px; margin-top: 50px;">Scroll down to see the floating ad appear!</p>
    <p style="height: 500px;">More content...</p>


    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs_5.vast.vpaid.min.js"></script>

    <script>
        const player = videojs('my-video');
        let adPlayedInVideo = false;
        let videoResumeTime = 0; // Store the time to resume the main video from

        console.log('Script loaded. VideoJS player created.');

        player.ready(function () {
            console.log('VideoJS player is ready.');
            
            // Set up ad event listeners ONCE in the player.ready function.
            player.on('adended', function () {
                console.log('VAST Ad Ended. Resuming main video from', videoResumeTime);
                player.currentTime(videoResumeTime); // Seek back to where it paused
                player.play(); // Resume main video playback
            });

            player.on('aderror', function (e) {
                console.error('VAST Ad Error:', e);
                // In case of an ad error, resume the main video
                console.log('Ad error. Resuming main video from', videoResumeTime);
                player.currentTime(videoResumeTime); // Seek back to where it paused
                player.play(); 
            });

            player.on('adstart', function() {
                console.log('VAST Ad Started.');
            });
            player.on('adskip', function() {
                console.log('VAST Ad Skipped.');
                console.log('Ad skipped. Resuming main video from', videoResumeTime);
                player.currentTime(videoResumeTime);
                player.play();
            });

            // Listen for time updates on the main video
            player.on('timeupdate', function () {
                const currentTime = player.currentTime();
                // console.log('Time update:', currentTime.toFixed(2)); // Uncomment for detailed timing

                if (!adPlayedInVideo && currentTime >= 5) {
                    adPlayedInVideo = true; // Set flag to true to prevent re-triggering

                    videoResumeTime = currentTime; // Store current time before pausing
                    player.pause(); // PAUSE THE MAIN VIDEO FIRST

                    console.log('--- 5 seconds reached. Pausing video and initializing VAST ad ---');
                    
                    // Initialize the VAST plugin ONLY AT THIS MOMENT
                    // 'playAdAlways: true' will tell it to play as soon as it's set up.
                    player.vastClient({
                        adTagUrl: "http://161.97.141.58:8080/www/delivery/fc.php?script=apVideo:vast2&zoneid=7",
                        playAdAlways: true, 
                        verbosity: 4, // Increase verbosity for detailed console logging
                        // You might need these if your VAST contains VPAID Flash creatives
                        // vpaidFlashLoaderPath: "https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/VPAIDFlash.swf", 
                        // vpaidFlashPath: "https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/VPAIDFlash.swf"
                    });

                    // Remove the timeupdate listener once the ad has been triggered
                    player.off('timeupdate'); 
                    console.log('Timeupdate listener removed.');
                }
            });
        });

        // JavaScript for the floating ad (remains the same)
        const floatingAdContainer = document.getElementById('floating-ad-container');
        const closeFloatingAd = document.getElementById('close-floating-ad');
        let floatingAdVisible = false;

        // Show floating ad on scroll
        window.addEventListener('scroll', function() {
            if (!floatingAdVisible && window.scrollY > 200) { // Show after scrolling 200px
                floatingAdContainer.classList.add('show');
                floatingAdVisible = true;
            }
            // Optional: Hide floating ad if scrolled back up
            if (floatingAdVisible && window.scrollY < 200) {
                floatingAdContainer.classList.remove('show');
                floatingAdVisible = false;
            }
        });

        // Close floating ad
        closeFloatingAd.addEventListener('click', function() {
            floatingAdContainer.classList.remove('show');
            floatingAdVisible = false; 
        });

    </script>

</body>
</html>